<!DOCTYPE html>
<html>
    <head>
        <title>DJnator</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <style>
            html, body, #pantalla
            {
                width: 100%;
                height: 100%;
            }
            
            .arriba, .abajo, .izquierda, .derecha, .disparo1, .disparo2
            {
                background-size: contain;
                background-repeat: no-repeat;
                background-position: center;
            }
            
            .arriba
            {
                background-image: url('img/salto.png');
            }
            
            .abajo
            {
                background-image: url('img/brazosarriba.png');
            }
            
            .izquierda
            {
                background-image: url('img/izda.png');
            }
            
            .derecha
            {
                background-image: url('img/derecha.png');
            }
            
            .disparo1
            {
                background-image: url('img/aplaudir.png');
            }
            
            .disparo2
            {
                background: none;
            }
        </style>
        
        <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
        <script>
            $(function () {
                update();
            });
            function update()
            {
                $.ajax({
                        url: "http://10.10.2.11:8080/api/getdj",
                        context: document.body
                    }).done(function (json) {
                        
                        datos = $.parseJSON(json);
                        
                        var capa = $('#pantalla');
                        capa.html(datos.mola + "," + datos.cuernos + "," + datos.nomola + "," + datos.accion);
                        
                        switch(datos.accion)
                        {
                            case 1:
                                capa.attr('class', 'arriba');
                                break;
                            case 2:
                                capa.attr('class', 'abajo');
                                break;
                            case 3:
                                capa.attr('class', 'izquierda');
                                break;
                            case 4:
                                capa.attr('class', 'derecha');
                                break;
                            case 5:
                                capa.attr('class', 'disparo1');
                                break;
                            case 6:
                                capa.attr('class', 'disparo2');
                                break;
                        }
                        
                        var totalvotos = datos.mola + datos.nomola;
                        var diferencia =0;
                        var valor = 0;
                        var color = 00;
                        if (datos.mola > datos.nomola) {
                            diferencia = datos.mola - datos.nomola;
                            valor = 256-Math.round((diferencia / totalvotos) * 256);
                            color = "rgb(" + valor + ",255," + valor + ")";
                        } else {
                            diferencia = datos.nomola - datos.mola;
                            valor = 256-Math.round((diferencia / totalvotos) * 256);
                            color = "rgb(255," + valor + "," + valor + ")";
                        }
                        
                        capa.html(datos.mola + "," + datos.cuernos + "," + datos.nomola + "," + datos.accion + 
                                " totalvotos:" + totalvotos + " diferencia:" + diferencia + " valor:" + valor + 
                                color);
                        
                        capa.css('background-color',color);

                        
                        setTimeout(update, 100);
                    });
            }
        </script>
    </head>
    <body>
        <div id="pantalla" class="arriba">
            &nbsp;
        </div>
    </body>
</html>
